<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluación Académica</title>

<style>
:root{
 --primary:#2c3e50;
 --background:#f4f7f6;
}
body{
 font-family:Segoe UI,sans-serif;
 background:var(--background);
 padding:20px;
}
.container{
 max-width:900px;
 margin:auto;
 background:white;
 padding:30px;
 border-radius:8px;
 box-shadow:0 4px 6px rgba(0,0,0,0.1);
}
.question-card{
 margin-bottom:20px;
 padding:15px;
 border-left:5px solid var(--primary);
 background:#f9f9f9;
}
.option{
 display:block;
 padding:8px;
 margin:5px 0;
 border:1px solid #ddd;
 border-radius:4px;
 cursor:pointer;
}
button{
 background:var(--primary);
 color:white;
 border:none;
 padding:10px 20px;
 border-radius:4px;
 cursor:pointer;
 margin-top:15px;
}
.hidden{display:none;}
input[type="text"]{
 width:100%;
 padding:8px;
 margin-bottom:15px;
}
</style>
</head>
<body>

<div class="container">
<h1>Evaluación Académica</h1>

<label>Nombre del estudiante:</label>
<input type="text" id="studentName">

<div id="quiz-container" class="hidden">
 <div id="questions-area"></div>
 <button id="submit-btn">Finalizar y Calificar</button>
</div>

<div id="result-container" class="hidden">
 <h2>Resultado</h2>
 <p id="score-text" style="font-weight:bold;font-size:1.3em;"></p>
 <button onclick="location.reload()">Reiniciar</button>
</div>

</div>

<script>

let questions=[];
let startTime;

window.onload=loadFile;

function loadFile(){

 const url="https://jorge21028.github.io/CuestionarioAiken/AIKEN.txt";

 fetch(url)
 .then(res=>res.text())
 .then(text=>{
     parseAiken(text);
     startQuiz();
 })
 .catch(err=>alert("Error cargando archivo"));
}

function parseAiken(text){

 const lines=text.split(/\r?\n/);
 let current=null;

 lines.forEach(line=>{
   line=line.trim();
   if(!line) return;

   if(line.startsWith("ANSWER:")){
     current.answer=line.split(":")[1].trim().split(/[\s,]+/);
     current.id=questions.length;
     questions.push(current);
     current=null;
   }
   else if(/^[A-Z][\.\)]/.test(line)){
     current.options.push({
       letter:line[0],
       content:line.substring(2).trim()
     });
   }
   else{
     current={question:line,options:[]};
   }
 });
}

function startQuiz(){
 document.getElementById("quiz-container").classList.remove("hidden");
 render();
 startTime=new Date();
}

function render(){

 const area=document.getElementById("questions-area");
 area.innerHTML="";

 questions.forEach((q,i)=>{

  const div=document.createElement("div");
  div.className="question-card";
  div.innerHTML=`<strong>${i+1}. ${q.question}</strong>`;

  q.options.forEach(opt=>{
   const label=document.createElement("label");
   label.className="option";
   label.innerHTML=`
   <input type="checkbox" name="q${q.id}" value="${opt.letter}">
   ${opt.letter}) ${opt.content}`;
   div.appendChild(label);
  });

  area.appendChild(div);
 });
}

document.getElementById("submit-btn").onclick=finish;

function finish(){

 const name=document.getElementById("studentName").value.trim();
 if(!name){ alert("Escriba su nombre"); return; }

 let correct=0;

 questions.forEach(q=>{
  const selected=[...document.querySelectorAll(`input[name="q${q.id}"]:checked`)]
  .map(e=>e.value).sort();

  const expected=[...q.answer].sort();

  if(JSON.stringify(selected)===JSON.stringify(expected)) correct++;
 });

 const total=questions.length;
 const percent=((correct/total)*100).toFixed(1);
 const duration=Math.floor((new Date()-startTime)/1000);

 document.getElementById("quiz-container").classList.add("hidden");
 document.getElementById("result-container").classList.remove("hidden");
 document.getElementById("score-text").innerText=
 `Resultado: ${correct}/${total} (${percent}%)`;

 sendData({
   name,
   correct,
   total,
   percent,
   duration
 });
}

function sendData(data){

 fetch("https://script.google.com/macros/s/AKfycby5nLCiXBzgTdowk-ryWhYg9Wh4GO2hCEX61pyIH0n3SWeueB6flWs_QJAVW8p1Rxjf/exec",{
   method:"POST",
   mode:"no-cors",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify(data)
 });

}

</script>
</body>
</html>
